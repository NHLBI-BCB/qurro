<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>
            rankratioviz
        </title>
        <link rel="shortcut icon" href="icon.png" />
        <link rel="stylesheet" href="rankratioviz.css" />
        <!-- External dependencies here: Vega, Vega-Lite, Vega-Embed.
             All are required for Vega-Embed: see the Basic Example in
             https://github.com/vega/vega-embed.
        -->
        <script src="vendor/vega.min.js"></script>
        <script src="vendor/vega-lite.min.js"></script>
        <script src="vendor/vega-embed.min.js"></script>
        <script src="rankratioviz.js"></script>
    </head>

    <body>
        <table id="rrvTable">
            <!-- Show the actual plots -->
            <tr>
                <td class="plotTD" id="rankPlotTD">
                    <div id="rankPlot"></div>
                </td>
                <td class="plotTD" id="samplePlotTD">
                    <div id="samplePlot"></div>
                </td>
            </tr>
            <tr>
                <td class="topAlignedTD">
                    <h3>Single-Feature Selections</h3>
                    <p>
                        Select two features from the rank plot (left) to
                        display their log ratios for each sample in the sample
                        scatterplot (right).
                    </p>
                    <!-- Note for future reference: whitespace between the
                        start and end tag of a textarea is apparently
                        interpreted as just that, and preserved in the textarea
                        on the page.
                        (So that's why the textarea declarations below are on
                        long lines.)
                    -->
                    <p>
                        <textarea id="topTaxaDisplay" rows="6"></textarea>
                    </p>
                    <hr />
                    <p>
                        <textarea id="botTaxaDisplay" rows="6"></textarea>
                    </p>
                </td>
                <td>
                    <h3>Multi-Feature Selections</h3>
                    <p>
                        Use the controls here to show more complex log ratios
                        in the sample scatterplot.
                    </p>
                    <p>
                        Filter numerator to features that
                        <select id="topSearch">
                            <option value="rank">
                                contain the exact rank(s)
                            </option>
                            <option value="text">
                                contain the exact text
                            </option>
                        </select>
                        <input type="text" id="topText" size="40"></input>
                    </p>
                    <p>
                        Filter denominator to features that
                        <select id="botSearch">
                            <option value="rank">
                                contain the exact rank(s)
                            </option>
                            <option value="text">
                                contain the exact text
                            </option>
                        </select>
                        <input type="text" id="botText" size="40"></input>
                    </p>

                    <p>
                        <button onclick="ssmv.updateSamplePlotMulti();">
                            Regenerate sample plot
                        </button>
                    </p>
                    <p>
                        <label for="selectMicrobesFileSelector">
                            <strong>
                                Upload "Select Features" List:
                            </strong>
                        </label>
                        <input type="file" id="selectMicrobesFileSelector"
                            onChange="ssmv.uploadSelectMicrobesFile();" />
                    </p>
                    <p>
                        <label for="zeroFillInput">
                            <strong>
                                Value to fill in for zero-abundance features:
                            </strong>
                        </label>
                        <input type="number" id="zeroFillInput" min="0"
                            max="1000" value="0">
                        </input>
                    </p>
                </td>
        </table>
        <!-- This file will be created by the rankratioviz python script.
             It will contain definitions for ssmv.rankPlotJSON and
             ssmv.samplePlotJSON, and then invoke ssmv.makeRankPlot() and
             ssmv.makeSamplePlot().

             Leaving this code at the bottom of the page is sufficient to wait
             until the rest of the stuff in the page has been loaded:
             see https://stackoverflow.com/a/1861233.

             We need to wait for the page to load before trying to construct
             the Vega plots using vegaEmbed(); otherwise, plots.js' uses of
             ssmv.makeRankPlot() and ssmv.makeSamplePlot() (which call
             vegaEmbed()) will fail with the "ERROR: Signal bind element not
             found: null" error described at
             https://github.com/vega/vega-embed/issues/64.

             In the past, this "accidentally" worked because I loaded the JSON
             files using XMLHTTPRequests, which apparently take long enough /
             start after the page has loaded. Switching to embedding the JSON
             directly in the JS code caused this to start failing (since
             the make...Plot() methods were being called immediately, and the
             #rankPlot and #samplePlot DOM elements didn't exist yet).
             Delaying the JSON loading and make...Plot() methods being called
             until after everything else has been loaded (as is done by loading
             the plots.js script at the bottom of the markup) fixes this.
        -->
        <script src="plots.js"></script>
    </body>
</html>
